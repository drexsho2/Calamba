<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Previous head content remains the same until the style section -->
  <style>
    /* Add these new styles to your existing style section */
    
    .driver-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .remove-driver {
      background: #ef4444 !important;
      color: white !important;
      padding: 4px 8px;
      font-size: 0.8rem;
    }
    
    .driver-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .status-available {
      background: #bbf7d0;
      color: #166534;
    }
    
    .status-assigned {
      background: #bfdbfe;
      color: #1e40af;
    }
    
    .status-arrived {
      background: #fef08a;
      color: #854d0e;
    }
    
    .booking-progress {
      margin-top: 10px;
      background: #e5e7eb;
      border-radius: 4px;
      height: 6px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: #10b981;
      width: 0%;
      transition: width 0.3s;
    }
    
    .action-buttons {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    
    .btn-arrived {
      background: #f59e0b !important;
      color: white !important;
    }
    
    .btn-complete {
      background: #10b981 !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <!-- Previous body content remains the same until the admin dashboard section -->
  
  <!-- Update the admin dashboard drivers list section -->
  <div id="drivers-list"></div>
  
  <!-- Update the driver dashboard current assignment section -->
  <div id="current-assignment"></div>
  
  <!-- The rest of the HTML remains the same -->

  <script>
    // Update the loadAdminData function with remove driver capability
    function loadAdminData() {
      const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
      const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
      
      const driversList = document.getElementById('drivers-list');
      driversList.innerHTML = '';
      
      drivers.forEach(driver => {
        const driverCard = document.createElement('div');
        driverCard.className = 'driver-card';
        driverCard.innerHTML = `
          <h4>${driver.name}</h4>
          <p>${driver.vehicle}</p>
          <p>Status: <span class="driver-status status-${driver.status}">${driver.status}</span></p>
          ${driver.location ? 
            `<p>Location: ${driver.location.lat.toFixed(4)}, ${driver.location.lng.toFixed(4)}</p>` : 
            '<p>Location: Unknown</p>'}
          <div class="driver-actions">
            <button class="control-btn remove-driver" data-driver="${driver.id}">
              <i class="material-icons">delete</i> Remove
            </button>
          </div>
        `;
        driversList.appendChild(driverCard);
      });
      
      // Add event listeners to remove buttons
      document.querySelectorAll('.remove-driver').forEach(btn => {
        btn.addEventListener('click', function() {
          removeDriver(this.getAttribute('data-driver'));
        });
      });
      
      // Rest of the admin data loading remains the same
    }
    
    // Add this new function to remove drivers
    function removeDriver(driverId) {
      if (confirm('Are you sure you want to remove this driver?')) {
        const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
        const updatedDrivers = drivers.filter(d => d.id !== driverId);
        localStorage.setItem('angkasDrivers', JSON.stringify(updatedDrivers));
        showStatus('Driver removed successfully', 'success');
        loadAdminData();
      }
    }
    
    // Update the loadDriverData function with complete booking flow
    function loadDriverData() {
      const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
      const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
      const driver = drivers.find(d => d.id === currentDriverId);
      
      if (!driver) return;
      
      const currentAssignment = document.getElementById('current-assignment');
      currentAssignment.innerHTML = '';
      
      if (driver.status === 'assigned' || driver.status === 'arrived') {
        const booking = bookings.find(b => b.id === driver.bookingId);
        if (booking) {
          const progress = booking.progress || 0;
          
          const assignmentCard = document.createElement('div');
          assignmentCard.className = 'booking-card';
          assignmentCard.innerHTML = `
            <h4>Current Assignment</h4>
            <p>From: ${booking.pickup}</p>
            <p>To: ${booking.destination}</p>
            <p>Fare: ${booking.fare}</p>
            <p>Status: <span class="driver-status status-${booking.status}">${booking.status}</span></p>
            <div class="booking-progress">
              <div class="progress-bar" style="width: ${progress}%"></div>
            </div>
            <div class="action-buttons">
              ${driver.status === 'assigned' ? 
                `<button id="arrived-btn" class="control-btn btn-arrived">
                  <i class="material-icons">place</i> Mark as Arrived
                </button>` : ''}
              ${driver.status === 'arrived' ? 
                `<button id="start-trip-btn" class="control-btn">
                  <i class="material-icons">directions_bike</i> Start Trip
                </button>` : ''}
              ${booking.status === 'in_progress' ?
                `<button id="complete-btn" class="control-btn btn-complete">
                  <i class="material-icons">check_circle</i> Complete Trip
                </button>` : ''}
            </div>
          `;
          currentAssignment.appendChild(assignmentCard);
          
          if (driver.status === 'assigned') {
            document.getElementById('arrived-btn').addEventListener('click', () => {
              markDriverArrived(driver.id);
            });
          }
          
          if (driver.status === 'arrived') {
            document.getElementById('start-trip-btn').addEventListener('click', () => {
              startTrip(booking.id);
            });
          }
          
          if (booking.status === 'in_progress') {
            document.getElementById('complete-btn').addEventListener('click', () => {
              completeTrip(booking.id);
            });
            
            // Simulate trip progress
            if (!booking.progressInterval) {
              booking.progressInterval = setInterval(() => {
                const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
                const currentBooking = bookings.find(b => b.id === booking.id);
                if (currentBooking) {
                  currentBooking.progress = Math.min(100, (currentBooking.progress || 0) + 5);
                  localStorage.setItem('angkasBookings', JSON.stringify(bookings));
                  document.querySelector('.progress-bar').style.width = `${currentBooking.progress}%`;
                }
              }, 2000);
              localStorage.setItem('angkasBookings', JSON.stringify(bookings));
            }
          }
        }
      } else {
        currentAssignment.innerHTML = '<p>No current assignments</p>';
      }
      
      // Rest of the driver data loading remains the same
    }
    
    // Add these new functions for the booking flow
    function markDriverArrived(driverId) {
      const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
      const driver = drivers.find(d => d.id === driverId);
      
      if (driver) {
        driver.status = 'arrived';
        localStorage.setItem('angkasDrivers', JSON.stringify(drivers));
        
        const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
        const booking = bookings.find(b => b.id === driver.bookingId);
        if (booking) {
          booking.status = 'driver_arrived';
          localStorage.setItem('angkasBookings', JSON.stringify(bookings));
        }
        
        showStatus('You have arrived at pickup location', 'success');
        loadDriverData();
      }
    }
    
    function startTrip(bookingId) {
      const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
      const booking = bookings.find(b => b.id === bookingId);
      
      if (booking) {
        booking.status = 'in_progress';
        booking.progress = 0;
        localStorage.setItem('angkasBookings', JSON.stringify(bookings));
        
        showStatus('Trip started! Taking customer to destination', 'success');
        loadDriverData();
      }
    }
    
    function completeTrip(bookingId) {
      const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
      const booking = bookings.find(b => b.id === bookingId);
      
      if (booking) {
        // Clear the progress interval
        if (booking.progressInterval) {
          clearInterval(booking.progressInterval);
          delete booking.progressInterval;
        }
        
        booking.status = 'completed';
        localStorage.setItem('angkasBookings', JSON.stringify(bookings));
        
        const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
        const driver = drivers.find(d => d.bookingId === bookingId);
        if (driver) {
          driver.status = 'available';
          driver.bookingId = null;
          localStorage.setItem('angkasDrivers', JSON.stringify(drivers));
        }
        
        showStatus('Trip completed successfully!', 'success');
        loadDriverData();
      }
    }
    
    // Update the simulateDriverMovement function to stop when arrived
    function simulateDriverMovement(driverId, booking) {
      const interval = setInterval(() => {
        const drivers = JSON.parse(localStorage.getItem('angkasDrivers'));
        const driver = drivers.find(d => d.id === driverId);
        
        if (!driver || !booking.customerLocation) {
          clearInterval(interval);
          return;
        }
        
        if (!driver.location) {
          driver.location = {
            lat: booking.customerLocation.lat + (Math.random() * 0.02 - 0.01),
            lng: booking.customerLocation.lng + (Math.random() * 0.02 - 0.01)
          };
        } else {
          driver.location.lat += (booking.customerLocation.lat - driver.location.lat) * 0.1;
          driver.location.lng += (booking.customerLocation.lng - driver.location.lng) * 0.1;
        }
        
        localStorage.setItem('angkasDrivers', JSON.stringify(drivers));
        
        const distance = Math.sqrt(
          Math.pow(booking.customerLocation.lat - driver.location.lat, 2) +
          Math.pow(booking.customerLocation.lng - driver.location.lng, 2)
        );
        
        if (distance < 0.001) {
          clearInterval(interval);
          driver.status = 'arrived';
          localStorage.setItem('angkasDrivers', JSON.stringify(drivers));
          
          const bookings = JSON.parse(localStorage.getItem('angkasBookings'));
          const updatedBooking = bookings.find(b => b.id === booking.id);
          if (updatedBooking) {
            updatedBooking.status = 'driver_arrived';
            localStorage.setItem('angkasBookings', JSON.stringify(bookings));
          }
          
          loadDriverData();
        }
      }, 1000);
    }
  </script>
</body>
</html>
